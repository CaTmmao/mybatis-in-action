<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.github.hcsp.mybatis">
  <select id="getInnerJoinOrders" resultMap="orderResultMap">
    select 
    `order`.id as "order_id", 
    user.id as "user_id"
    user.name as "user_name",
    user.tel as "user_tel",
    user.address as "user_address",
    goods.id as "goods_id",
    goods.name as "goods_name",
    goods.price as "goods_price", 
    sum(`order`.goods_num*`order`.goods_price) as "totalPrice"
	from (`order` join goods on `order`.goods_id = goods.id)
	join user on `order`.user_id = user.id group by `order`.id,user.name,goods.name
  </select>
  <resultMap id="orderResultMap" type="com.github.hcsp.mybatis.entity.Order">
    <id column="order_id" property="id"/>
    <result column="totalPrice" property="totalPrice"/>
    <association property="user" javaType="com.github.hcsp.mybatis.entity.User">
        <id column="user_id" property="id"/>
        <result column="user_name" property="name"/>
        <result column="user_tel" property="tel"/>
        <result column="user_address" property="address"/>
    </association>
    <association property="goods" javaType="com.github.hcsp.mybatis.entity.Goods">
        <id column="goods_id" property="id"/>
        <result column="goods_name" property="name"/>
        <result column="goods_price" property="price"/>
    </association>
  </resultMap>
</mapper>
